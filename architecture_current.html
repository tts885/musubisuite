<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ - Corexverse</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --card-bg: #ffffff;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        body {
            font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 60px 0;
            margin-bottom: 40px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        h1 {
            font-size: 2.5rem;
            margin: 0 0 10px 0;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .section {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .section:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: var(--secondary-color);
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
            margin-top: 0;
        }

        h3 {
            color: var(--primary-color);
            margin-top: 25px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: #f1f5f9;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }

        .tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-right: 5px;
            margin-bottom: 5px;
        }

        .tag.react {
            background: #e0f2fe;
            color: #0369a1;
        }

        .tag.django {
            background: #dcfce7;
            color: #15803d;
        }

        .tag.infra {
            background: #f3e8ff;
            color: #7e22ce;
        }

        .mermaid {
            background: white;
            padding: 20px;
            border-radius: 8px;
            display: flex;
            justify-content: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background-color: #f8fafc;
            font-weight: 600;
        }

        .status-good {
            color: var(--success);
            font-weight: bold;
        }

        code {
            background: #e2e8f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>

<body>

    <header>
        <div class="header-content">
            <h1>ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ</h1>
            <div class="subtitle">Corexverse Project - Current Architecture Status</div>
        </div>
    </header>

    <div class="container">

        <!-- Executive Summary -->
        <div class="section">
            <h2>ğŸ“Š ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼</h2>
            <p>
                Corexverseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ãŒå®Œäº†ã—ã€æ¨å¥¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¸ã®ç§»è¡ŒãŒå®Ÿç¾ã—ã¾ã—ãŸã€‚
                Docker Composeã«ã‚ˆã‚‹å®Œå…¨ãªã‚³ãƒ³ãƒ†ãƒŠåŒ–ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚µãƒ¼ãƒ“ã‚¹å±¤åˆ†é›¢ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æ©Ÿèƒ½ãƒ™ãƒ¼ã‚¹æ§‹é€ åŒ–ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚
                ã“ã‚Œã«ã‚ˆã‚Šã€é–‹ç™ºç’°å¢ƒã®çµ±ä¸€ã€ä¿å®ˆæ€§ã®å‘ä¸Šã€ãŠã‚ˆã³å°†æ¥çš„ãªã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ãŒç¢ºä¿ã•ã‚Œã¾ã—ãŸã€‚
            </p>
        </div>

        <!-- System Overview -->
        <div class="section">
            <h2>ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“æ§‹æˆ</h2>
            <p>Docker Composeã«ã‚ˆã‚Šã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚ŒãŸã€ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³ã§ã™ã€‚</p>

            <div class="mermaid">
                graph TD
                subgraph "Host Machine"
                direction TB

                subgraph "Docker Compose Network"
                Frontend["Frontend Container<br>(Nginx + React Build)"]
                Backend["Backend Container<br>(Gunicorn + Django)"]
                DB[("PostgreSQL<br>(Database)")]
                Redis[("Redis<br>(Cache/Queue)")]
                end
                end

                subgraph "External"
                User["User Browser"]
                OpenAI["OpenAI API"]
                Dataverse["MS Dataverse"]
                end

                User -->|"HTTP/80<br>(Port 3000 mapped)"| Frontend
                Frontend -->|"API Requests<br>/api/*"| Backend
                Backend -->|"SQL"| DB
                Backend -->|"Cache"| Redis
                Backend -->|"External API"| OpenAI
                Backend -->|"Sync"| Dataverse
            </div>
        </div>

        <!-- Class Diagram -->
        <div class="section">
            <h2>ğŸ§© ã‚¯ãƒ©ã‚¹å›³ (ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)</h2>
            <p>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚µãƒ¼ãƒ“ã‚¹å±¤ã¨ãƒ¢ãƒ‡ãƒ«ã€ãŠã‚ˆã³ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä¾å­˜é–¢ä¿‚ã‚’ç¤ºã—ã¾ã™ã€‚</p>

            <div class="mermaid">
                classDiagram
                %% Backend Classes
                namespace Backend {
                class ProjectViewSet {
                +list()
                +create()
                +dashboard_stats()
                }
                class ProjectService {
                +get_project_stats()
                +get_project_attachments()
                }
                class AIService {
                +stream_ai_response()
                }
                class Project {
                +String name
                +String status
                +is_overdue()
                }
                class Attachment {
                +String file_name
                +String url
                }
                }

                %% Frontend Classes
                namespace Frontend {
                class DjangoAPIClient {
                +getProjects()
                +createProject()
                +getDashboardStats()
                }
                class ProjectListPage {
                +render()
                }
                }

                %% Relationships
                ProjectListPage ..> DjangoAPIClient : uses
                DjangoAPIClient ..> ProjectViewSet : HTTP Request
                ProjectViewSet ..> ProjectService : uses
                ProjectViewSet ..> AIService : uses
                ProjectService ..> Project : queries
                ProjectService ..> Attachment : queries
                Project "1" *-- "*" Attachment : has
            </div>
        </div>

        <!-- Data Flow Diagram -->
        <div class="section">
            <h2>ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ (Data Flow)</h2>
            <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã™ã‚‹éš›ã®ã€å…·ä½“çš„ãªãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã‚’ç¤ºã—ã¾ã™ã€‚</p>

            <div class="mermaid">
                sequenceDiagram
                participant User
                participant FE as Frontend (React)
                participant API as DjangoAPIClient
                participant BE as Backend (View)
                participant SVC as ProjectService
                participant DB as PostgreSQL

                Note over User, FE: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’é–‹ã
                User->>FE: Access Dashboard
                FE->>API: getDashboardStats()

                Note over API, BE: JWTèªè¨¼ä»˜ããƒªã‚¯ã‚¨ã‚¹ãƒˆ
                API->>BE: GET /api/projects/dashboard_stats/

                BE->>SVC: get_project_stats()

                Note over SVC, DB: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè¡Œ
                SVC->>DB: Count Projects (Active)
                DB-->>SVC: Result: 5
                SVC->>DB: Count Projects (Completed)
                DB-->>SVC: Result: 12

                SVC-->>BE: Return Stats Dict
                BE-->>API: JSON Response { total: 17, ... }
                API-->>FE: Data Object
                FE-->>User: Render Charts
            </div>
        </div>

        <!-- OCR Data Flow Diagram -->
        <div class="section">
            <h2>ğŸ“„ OCRæ©Ÿèƒ½ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼</h2>
            <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒOCRãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã€å‡¦ç†çµæœã‚’å–å¾—ã™ã‚‹ã¾ã§ã®æµã‚Œã‚’ç¤ºã—ã¾ã™ã€‚</p>

            <div class="mermaid">
                sequenceDiagram
                participant User
                participant FE as Frontend (React)
                participant OcrSvc as ocrDataverseService
                participant DV as MS Dataverse
                participant Storage as File Storage

                Note over User, FE: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                User->>FE: Select Files & Folder
                FE->>FE: Validate Files (Type, Size)

                Note over FE, DV: Dataverseã¸ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç™»éŒ²
                FE->>OcrSvc: createDocument(metadata, file)
                OcrSvc->>DV: Create cx_ocrdocument Record
                DV-->>OcrSvc: Document ID

                Note over OcrSvc, Storage: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                OcrSvc->>Storage: Upload File Binary
                Storage-->>OcrSvc: File URL

                OcrSvc->>DV: Update Document (fileUrl, status)
                DV-->>OcrSvc: Success
                OcrSvc-->>FE: Document Created
                FE-->>User: Upload Success

                Note over User, FE: OCRå‡¦ç†çµæœã®ç¢ºèª
                User->>FE: Open Document Detail
                FE->>OcrSvc: getDocument(documentId)
                OcrSvc->>DV: Query cx_ocrdocument
                DV-->>OcrSvc: Document + OCR Results
                OcrSvc-->>FE: Document Object
                FE-->>User: Display OCR Results
            </div>
        </div>

        <!-- Directory Structure -->
        <div class="section">
            <h2>ğŸ“‚ å®Ÿè£…ã•ã‚ŒãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ</h2>
            <div class="grid">
                <div>
                    <h3>Frontend (corexverse/)</h3>
                    <pre><code>
corexverse/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ features/          # æ©Ÿèƒ½ãƒ™ãƒ¼ã‚¹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”‚   â”œâ”€â”€ auth/          # èªè¨¼ãƒ»ãƒ­ã‚°ã‚¤ãƒ³
â”‚   â”‚   â”œâ”€â”€ projects/      # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ocr/           # OCRæ©Ÿèƒ½
â”‚   â”‚   â”œâ”€â”€ settings/      # è¨­å®šç”»é¢
â”‚   â”‚   â”œâ”€â”€ tasks/         # ã‚¿ã‚¹ã‚¯ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ dashboard/     # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”‚   â””â”€â”€ tool-portal/   # ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã‚¿ãƒ«
â”‚   â”‚
â”‚   â”œâ”€â”€ components/        # å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ ui/            # åŸºæœ¬UIãƒ‘ãƒ¼ãƒ„
â”‚   â”‚   â”œâ”€â”€ layout/        # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”‚   â”œâ”€â”€ ocr/           # OCRå°‚ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ services/          # APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ djangoAPI.ts   # Django APIçµ±åˆ
â”‚   â”‚   â”œâ”€â”€ ocrService.ts  # OCRã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”œâ”€â”€ dataverseService.ts
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/             # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”œâ”€â”€ lib/               # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ types/             # TypeScriptå‹å®šç¾©
â”‚   â”œâ”€â”€ providers/         # Contextãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼
â”‚   â””â”€â”€ router.tsx         # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®š
â”‚
â”œâ”€â”€ Dockerfile             # ã‚³ãƒ³ãƒ†ãƒŠå®šç¾©
â””â”€â”€ package.json
                    </code></pre>
                </div>
                <div>
                    <h3>Backend (corexverseAPI/)</h3>
                    <pre><code>
corexverseAPI/
â”œâ”€â”€ config/                # Djangoè¨­å®š
â”‚   â”œâ”€â”€ settings.py
â”‚   â”œâ”€â”€ urls.py
â”‚   â””â”€â”€ wsgi.py
â”‚
â”œâ”€â”€ services/              # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤
â”‚   â”œâ”€â”€ project_service.py # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‡¦ç†
â”‚   â””â”€â”€ ai_service.py      # AIçµ±åˆå‡¦ç†
â”‚
â”œâ”€â”€ projects/              # Djangoã‚¢ãƒ—ãƒª: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
â”‚   â”œâ”€â”€ models.py          # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ views.py           # APIãƒ“ãƒ¥ãƒ¼
â”‚   â”œâ”€â”€ serializers.py     # ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶
â”‚   â””â”€â”€ urls.py
â”‚
â”œâ”€â”€ tasks/                 # Djangoã‚¢ãƒ—ãƒª: ã‚¿ã‚¹ã‚¯
â”œâ”€â”€ clients/               # Djangoã‚¢ãƒ—ãƒª: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”œâ”€â”€ members/               # Djangoã‚¢ãƒ—ãƒª: ãƒ¡ãƒ³ãƒãƒ¼
â”œâ”€â”€ activities/            # Djangoã‚¢ãƒ—ãƒª: ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£
â”œâ”€â”€ contracts/             # Djangoã‚¢ãƒ—ãƒª: å¥‘ç´„
â”œâ”€â”€ masters/               # Djangoã‚¢ãƒ—ãƒª: ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ ai_services/           # Djangoã‚¢ãƒ—ãƒª: AIé€£æº
â”œâ”€â”€ ai_settings/           # Djangoã‚¢ãƒ—ãƒª: AIè¨­å®š
â”‚
â”œâ”€â”€ Dockerfile             # ã‚³ãƒ³ãƒ†ãƒŠå®šç¾©
â”œâ”€â”€ requirements.txt       # Pythonä¾å­˜é–¢ä¿‚
â””â”€â”€ manage.py              # Djangoç®¡ç†ã‚³ãƒãƒ³ãƒ‰
                    </code></pre>
                </div>
            </div>
        </div>

    </div>

    <script>
        mermaid.initialize({ startOnLoad: true, theme: 'neutral' });
    </script>
</body>

</html>